<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
<title>
  HCPC 2011 Spring On-Site Contest 解题报告 |  Static Oneplus
</title>
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap-responsive.min.css">
<style type="text/css">
.prettyprint ol.linenums > li { list-style-type: decimal; }
.nav { }
.nav li { float: left; width: 70px; }
.content { padding: 30px 0; }
body, h1, h2, h3, h4 { font-family: "Fjalla One","Georgia","Helvetica Neue",Arial,sans-serif;}
header { width: 100%; height: 80px;}
blockquote p { font-size: 14px; }
</style>
</head>
<body>

<div class="container">
  <header class="header">
    <h1 class="site_title">Static Oneplus <small>不可控制论</small></h1>
    <ul class="nav pull-right">
      <li><a href="/">Home</a></li>
      <li><a href="/cv">CV</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="/notes">Notes</a></li>
      <li><a href="/feed.xml">RSS</a></li>
    </ul>
  </header>

  <div class="content">
    <div style="color:#999;">
  <small>2011/05/20 - by
    Oneplus

    
      &bull; <a href="/blog/tags/acm-group.html">ACM Group</a>
    
      &bull; <a href="/blog/tags/hcpc-2011-spring.html">HCPC 2011 Spring</a>
    
  </small>
</div>
<h2>HCPC 2011 Spring On-Site Contest 解题报告</h2>
<hr />
<div>
  <p>在解题报告的最前面，要对<a href="http://blog.oneplus.info/archives/230">上一篇</a>的中一句很不负责任的评论表达十分的歉意。出现这样的失误，完全是我没有认真组织题目校验，对于命题人投的题没有合理组织照成版本混乱，传达要求不清晰明确造成的。以后不管是我还是范利鑫，都要注意避免这样的问题发生。</p>

<div>_____________________________解题报告分割线_____________________________</div>

<p>网络赛C题的解题报告已经更新，想看的同学请移步<a href="http://blog.oneplus.info/archives/230#target">这里</a></p>

<div>_____________________________解题报告分割线_____________________________</div>

<p>赛前草草的测试赛中，70学长给出的各题目难度分布如下（感谢70）：</p>

<table width="100%">
<tr style="background:#eee"><th>Pid</th><th>Title</th><th>Author</th><th>Category</th><th>Expected Difficulty(5)</th></tr>
<tr><td><a href="http://acm.hit.edu.cn/judge/show.php?Proid=3024">A</a></td>
<td>Best Fit Ring</td><td>jerrybond</td><td>线段树DP</td><td>3</td></tr>
<tr><td><a href="http://acm.hit.edu.cn/judge/show.php?Proid=3025">B</a></td>
<td>Seven Road</td><td>Darkgt</td><td>随机化几何</td><td>3.5</td></tr>
<tr><td><a href="http://acm.hit.edu.cn/judge/show.php?Proid=3026">C</a></td>
<td>Shortest Path</td><td>Darkgt</td><td>贪心</td><td>3</td></tr>
<tr><td><a href="http://acm.hit.edu.cn/judge/show.php?Proid=3027">D</a></td>
<td>Power-supply System</td><td>Xnozero</td><td>BCC缩点、树DP</td><td>5</td></tr>
<tr><td><a href="http://acm.hit.edu.cn/judge/show.php?Proid=3028">E</a></td>
<td>Play Beans Beans</td><td>Lambyy</td><td>模拟</td><td>1.5</td></tr>
<tr><td><a href="http://acm.hit.edu.cn/judge/show.php?Proid=3029">F</a></td>
<td>Dictionary</td><td>yangjing</td><td>模拟</td><td>1</td></tr>
<tr><td><a href="http://acm.hit.edu.cn/judge/show.php?Proid=3030">G</a></td>
<td>Find the Fraction</td><td>Lambyy</td><td>分数序列、分数逼近</td><td>5++</td></tr>
<tr><td><a href="#">H</a></td>
<td>Rectangular Grid</td><td>SRM 146</td><td>水</td><td>0.5</td></tr>
<tr><td><a href="http://acm.hit.edu.cn/judge/show.php?Proid=3023">I</a></td>
<td>Zero Pair</td><td>Xnozero</td><td>Hash、模逆元</td><td>3</td></tr>
</table>

<p>赛前本来计划把Zero Pair放到A。这样，Power-supply System就自然被放到E的位置，Lambyy的模拟题也就不会造成这么多误会。但是在插数据表时被我脑残把I查到网络赛最后一题的位置了。（恩，没错，就是数据库pid一项出现重复，而且pid居然不是主键却又好像是Status表的外键，额…HOJ的数据库设计）结果就变成了Lambyy的水题都被大家当成难题了。另一件自我批评的是，整个比赛中出现：H数据范围不明，I题input错（后来证实是Zero把新题面给我但我没改），A的Sample错，D的Sample错，C的时限错。╮(╯_╰)╭</p>

<div>_____________________________解题报告分割线_____________________________</div>

<h4 id="best-fit-ring">Best Fit Ring</h4>

<p><em>[by jerrybond]</em> 计算各点到中心的距离，按距离大小将点排序，合并距离相等的点。问题转化为最大子段和问题。由于本题有动态更新每点的值，普通动态规划解决这个问题的复杂度为<em>O(QC<sup>2</sup>)</em>，对于本题数据范围不适用。需要线段树进行维护。</p>

<pre class="highlight cpp"><span class="cp">#include&lt;math.h&gt;
#include&lt;stdio.h&gt;
#include&lt;string.h&gt;
#include&lt;stdlib.h&gt;
</span>
<span class="cp">#define Max(x, y) (x)&gt;(y)?(x):(y)
</span>
<span class="k">struct</span> <span class="n">Point</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">dis</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
<span class="p">}</span><span class="n">pt</span><span class="p">[</span><span class="mi">100001</span><span class="p">];</span>

<span class="k">struct</span> <span class="n">Node</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">sum</span><span class="p">,</span> <span class="n">maxl</span><span class="p">,</span> <span class="n">maxr</span><span class="p">,</span> <span class="n">max</span><span class="p">;</span>
<span class="p">}</span><span class="n">node</span><span class="p">[</span><span class="mi">400001</span><span class="p">],</span> <span class="n">ans</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">id</span><span class="p">[</span><span class="mi">100001</span><span class="p">],</span> <span class="n">tot</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">100001</span><span class="p">];</span>

<span class="kt">void</span> <span class="nf">save</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">l</span> <span class="o">=</span> <span class="n">s</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">sum</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">l</span><span class="p">].</span><span class="n">sum</span> <span class="o">+</span> <span class="n">node</span><span class="p">[</span><span class="n">r</span><span class="p">].</span><span class="n">sum</span><span class="p">;</span>
    <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">maxl</span> <span class="o">=</span> <span class="n">Max</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">l</span><span class="p">].</span><span class="n">maxl</span><span class="p">,</span> <span class="n">node</span><span class="p">[</span><span class="n">l</span><span class="p">].</span><span class="n">sum</span> <span class="o">+</span> <span class="n">node</span><span class="p">[</span><span class="n">r</span><span class="p">].</span><span class="n">maxl</span><span class="p">);</span>
    <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">maxr</span> <span class="o">=</span> <span class="n">Max</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">r</span><span class="p">].</span><span class="n">maxr</span><span class="p">,</span> <span class="n">node</span><span class="p">[</span><span class="n">r</span><span class="p">].</span><span class="n">sum</span> <span class="o">+</span> <span class="n">node</span><span class="p">[</span><span class="n">l</span><span class="p">].</span><span class="n">maxr</span><span class="p">);</span>
    <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">max</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">l</span><span class="p">].</span><span class="n">maxr</span> <span class="o">+</span> <span class="n">node</span><span class="p">[</span><span class="n">r</span><span class="p">].</span><span class="n">maxl</span><span class="p">;</span>
    <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">max</span> <span class="o">=</span> <span class="n">Max</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">max</span><span class="p">,</span> <span class="n">node</span><span class="p">[</span><span class="n">l</span><span class="p">].</span><span class="n">max</span><span class="p">);</span>
    <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">max</span> <span class="o">=</span> <span class="n">Max</span><span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">max</span><span class="p">,</span> <span class="n">node</span><span class="p">[</span><span class="n">r</span><span class="p">].</span><span class="n">max</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">build</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="p">;</span>
    <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">sum</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">max</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">maxl</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">maxr</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="n">l</span><span class="p">].</span><span class="n">v</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="n">l</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">build</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">s</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">build</span><span class="p">(</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span> <span class="p">(</span><span class="n">s</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">save</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">l</span> <span class="o">&amp;</span> <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">r</span> <span class="o">==</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">sum</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">max</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">maxl</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">maxr</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">r</span> <span class="o">&gt;</span> <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">l</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">r</span> <span class="o">+</span> <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">l</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">mid</span><span class="p">)</span> <span class="n">insert</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="n">mid</span><span class="p">)</span> <span class="n">insert</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,(</span><span class="n">s</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">v</span><span class="p">);</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="n">insert</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">s</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
            <span class="n">insert</span><span class="p">(</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="p">(</span><span class="n">s</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">save</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">Node</span> <span class="nf">check</span><span class="p">(</span><span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">l</span> <span class="o">&amp;</span> <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">r</span> <span class="o">==</span> <span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">l</span> <span class="o">+</span> <span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">].</span><span class="n">r</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">mid</span><span class="p">)</span> <span class="k">return</span> <span class="n">check</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="n">mid</span><span class="p">)</span> <span class="k">return</span> <span class="n">check</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="p">(</span><span class="n">s</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">struct</span> <span class="n">Node</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">lt</span><span class="p">,</span> <span class="n">rt</span><span class="p">;</span>
        <span class="n">lt</span> <span class="o">=</span> <span class="n">check</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">s</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">rt</span> <span class="o">=</span> <span class="n">check</span><span class="p">(</span><span class="n">mid</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="p">(</span><span class="n">s</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">tmp</span><span class="p">.</span><span class="n">sum</span> <span class="o">=</span> <span class="n">lt</span><span class="p">.</span><span class="n">sum</span> <span class="o">+</span> <span class="n">rt</span><span class="p">.</span><span class="n">sum</span><span class="p">;</span>
        <span class="n">tmp</span><span class="p">.</span><span class="n">maxl</span> <span class="o">=</span> <span class="n">Max</span><span class="p">(</span><span class="n">lt</span><span class="p">.</span><span class="n">maxl</span><span class="p">,</span> <span class="n">lt</span><span class="p">.</span><span class="n">sum</span><span class="o">+</span><span class="n">rt</span><span class="p">.</span><span class="n">maxl</span><span class="p">);</span>
        <span class="n">tmp</span><span class="p">.</span><span class="n">maxr</span> <span class="o">=</span> <span class="n">Max</span><span class="p">(</span><span class="n">rt</span><span class="p">.</span><span class="n">maxr</span><span class="p">,</span> <span class="n">rt</span><span class="p">.</span><span class="n">sum</span><span class="o">+</span><span class="n">lt</span><span class="p">.</span><span class="n">maxr</span><span class="p">);</span>
        <span class="n">tmp</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">lt</span><span class="p">.</span><span class="n">maxr</span> <span class="o">+</span> <span class="n">rt</span><span class="p">.</span><span class="n">maxl</span><span class="p">;</span>
        <span class="n">tmp</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">Max</span><span class="p">(</span><span class="n">tmp</span><span class="p">.</span><span class="n">max</span><span class="p">,</span> <span class="n">lt</span><span class="p">.</span><span class="n">max</span><span class="p">);</span>
        <span class="n">tmp</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">Max</span><span class="p">(</span><span class="n">tmp</span><span class="p">.</span><span class="n">max</span><span class="p">,</span> <span class="n">rt</span><span class="p">.</span><span class="n">max</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">tmp</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">cmp</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span><span class="o">*</span><span class="n">p1</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span><span class="o">*</span><span class="n">p2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">Point</span><span class="o">*</span><span class="n">a1</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">Point</span><span class="o">*</span><span class="p">)</span><span class="n">p1</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">Point</span><span class="o">*</span><span class="n">a2</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">Point</span><span class="o">*</span><span class="p">)</span><span class="n">p2</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a1</span><span class="o">-&gt;</span><span class="n">dis</span><span class="o">&lt;</span><span class="n">a2</span><span class="o">-&gt;</span><span class="n">dis</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">a1</span><span class="o">-&gt;</span><span class="n">dis</span><span class="o">==</span><span class="n">a2</span><span class="o">-&gt;</span><span class="n">dis</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">str</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">"%d %d %d"</span><span class="p">,</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">,</span><span class="o">&amp;</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">,</span><span class="o">&amp;</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">);</span>
            <span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dis</span><span class="o">=</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="o">*</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span> <span class="o">+</span> <span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="o">*</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">;</span>
            <span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="o">=</span><span class="n">i</span><span class="p">;</span>
            <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">qsort</span><span class="p">(</span><span class="n">pt</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">Point</span><span class="p">),</span> <span class="n">cmp</span><span class="p">);</span>

        <span class="n">j</span><span class="o">=</span><span class="n">n</span><span class="p">;</span>
        <span class="n">tot</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">id</span><span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">id</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">j</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dis</span><span class="o">!=</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">dis</span><span class="p">)</span>
                <span class="n">pt</span><span class="p">[</span><span class="o">++</span><span class="n">tot</span><span class="p">]</span><span class="o">=</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="k">else</span> <span class="n">pt</span><span class="p">[</span><span class="n">tot</span><span class="p">].</span><span class="n">v</span><span class="o">+=</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">;</span>
            <span class="n">id</span><span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">]</span><span class="o">=</span><span class="n">tot</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">build</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">tot</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="n">m</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="sc">'C'</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">scanf</span> <span class="p">(</span><span class="s">"%d %d"</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
                <span class="n">pt</span><span class="p">[</span><span class="n">id</span><span class="p">[</span><span class="n">d</span><span class="p">]].</span><span class="n">v</span><span class="o">=</span><span class="n">pt</span><span class="p">[</span><span class="n">id</span><span class="p">[</span><span class="n">d</span><span class="p">]].</span><span class="n">v</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">;</span>
                <span class="n">p</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">=</span><span class="n">x</span><span class="p">;</span>
                <span class="n">insert</span><span class="p">(</span><span class="n">id</span><span class="p">[</span><span class="n">d</span><span class="p">],</span><span class="n">id</span><span class="p">[</span><span class="n">d</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span> <span class="n">pt</span><span class="p">[</span><span class="n">id</span><span class="p">[</span><span class="n">d</span><span class="p">]].</span><span class="n">v</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="n">check</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">tot</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
                <span class="n">printf</span> <span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">ans</span><span class="p">.</span><span class="n">max</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<h4 id="seven-roads">Seven Roads</h4>

<p><strong>[by Darkgt]</strong>此题是求平面点中共线最多的点数，对于一般的情况需要O(n<sup>2</sup>logn)的复杂度，枚举一个点需要O(n)复杂度，验证需要O(nlogn)。</p>

<p>此题明确所有的点最多只在7条直线上，因此如果随机选取一个点有大于1/7的概率取到最多点数的直线，如果每组数据只随机取30个点用来验证，在最坏的情况下有(6/7)<sup>30</sup>≤1%的概率算法错误，由于最多只有30组数据，理论上可以跑对全部数据。当然，适当增加或减小枚举的点数，可以影响程序的正确率和速度。</p>

<pre class="highlight cpp"><span class="cp">#include &lt;stdio.h&gt;
#include &lt;algorithm&gt;
#include &lt;iostream&gt;
#include &lt;cmath&gt;
#include &lt;ctime&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">tt</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">y</span><span class="p">;</span>
<span class="p">}</span> <span class="n">a</span><span class="p">[</span><span class="mi">10001</span><span class="p">];</span>
<span class="n">bool</span> <span class="nf">cmp</span><span class="p">(</span><span class="k">const</span> <span class="n">ttb</span><span class="p">,</span><span class="k">const</span> <span class="n">tt</span><span class="o">&amp;</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="o">==</span><span class="n">c</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="k">return</span> <span class="n">b</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">b</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">double</span> <span class="n">d</span><span class="p">[</span><span class="mi">10001</span><span class="p">];</span>
<span class="kt">double</span> <span class="n">INF</span> <span class="o">=</span> <span class="mf">1000000000.0</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">cal</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ans</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">max</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">)</span> <span class="k">return</span> <span class="n">n</span><span class="p">;</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">cnt</span><span class="o">=</span><span class="mi">30</span><span class="p">;</span>
    <span class="n">srand</span><span class="p">((</span><span class="kt">unsigned</span><span class="p">)</span> <span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">));</span>
    <span class="k">while</span><span class="p">(</span><span class="n">cnt</span><span class="o">--</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">i</span><span class="o">=</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="n">n</span><span class="p">;</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="n">j</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="o">==</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">x</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
            <span class="k">else</span>
                <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="kt">double</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">x</span><span class="p">);</span>
            <span class="n">k</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">sort</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">d</span><span class="o">+</span><span class="n">k</span><span class="p">);</span>
        <span class="n">max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">&lt;</span><span class="n">eps</span> <span class="p">)</span>
                <span class="n">max</span><span class="o">++</span><span class="p">;</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">max</span> <span class="o">&gt;</span> <span class="n">ans</span><span class="p">)</span>
                    <span class="n">ans</span> <span class="o">=</span> <span class="n">max</span><span class="p">;</span>
                <span class="n">max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">max</span> <span class="o">&gt;</span> <span class="n">ans</span><span class="p">)</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">max</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ans</span><span class="o">&lt;</span><span class="n">n</span><span class="o">/</span><span class="mi">7</span><span class="p">)</span> <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="n">ca</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span><span class="n">ca</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="n">ca</span><span class="o">--</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">"%d%d"</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">,</span><span class="o">&amp;</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">ans</span><span class="o">=</span><span class="n">cal</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">ans</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<h4 id="shortest-path">Shortest Path</h4>

<p><strong>[by Darkgt]</strong>如果用s[i]表示到达第i个位置所需最少步数，可以发现s[i-1]≤s[i]，具有dp的性质，但dp的复杂度无法解决此题。发现s[i]=p的位置是连续的并且由s[i]=p-1的位置转移到，于是每次可以转移s值相等的一个区间，复杂度O(n)。</p>

<pre class="highlight cpp"><span class="cp">#include &lt;cstdio&gt;
#include &lt;algorithm&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">M</span> <span class="o">=</span> <span class="mi">100005</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">x</span><span class="p">[</span><span class="n">M</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">ca</span><span class="p">;</span>
    <span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span><span class="n">ca</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="n">ca</span><span class="o">--</span><span class="p">){</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="kt">int</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nextright</span><span class="p">,</span><span class="n">ans</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="n">ans</span><span class="o">=</span><span class="mi">0</span><span class="p">;;</span><span class="n">ans</span><span class="o">++</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">right</span><span class="o">&lt;=</span><span class="n">left</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">ans</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">left</span><span class="o">&lt;=</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="o">&amp;</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="o">&lt;</span><span class="n">right</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
            <span class="n">nextright</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">left</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">right</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
                <span class="n">nextright</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">nextright</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
            <span class="n">left</span><span class="o">=</span><span class="n">right</span><span class="p">;</span>
            <span class="n">right</span><span class="o">=</span><span class="n">nextright</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">ans</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<h4 id="power-supply-system">Power-supply System</h4>

<p><strong>[by sevenzero]</strong>这题我和Xnozero合出来防AK的，题目是从CF64的E改的，原题是个n<sup>3</sup>的树DP，我想了n<sup>2</sup>的办法于是将原题数据改大了，考虑到刷刷的存在，为了增加难度就加了双连通分量的缩点，好吧，已经基本不可做了。</p>

<p>先缩点，不会的自己去学，值得一提的是双连通分量的缩点分为基于割和基于桥的两种，本来想出基于割的缩点（参考2010杭州regional的G），最后自己都觉得太恶心就换成基于桥的缩点了。</p>

<p>DP部分要用3个数组in、out、inm。</p>
<ul><li>in[i][j]为以i为根的子树中有发电站给i供电且与i的距离为j的最小花费，</li>
<li>inm[i]=min(in[i][j]) 辅助数组，</li>
<li>out[i][j]为以i为根的子树外有发电站给i供电且与i的距离为j或者在子树内有发电站给i供电的最小花费。</li></ul>

<p>对于in[i][j]:</p>
<ul><li>j=0时，说明就在i点建站，in[i][j]=sigma(out[son(i).k][j+1])+cost[i];</li>
<li>j&gt;0时，说明发电站来自i的某儿子在的子树，对于这个子树来说发电站在这个子树里，其他子树来说在发电站子树外，</li></ul>
<p>故方程有<code>in[i][j]=min(sigma(out[son(i).k][j+1])+in[son(i).k][j-1]-out[son(i).k][j+1]+f[j]),&lt;br /&gt;sigma(out[son(i).k][j+1])</code>可以提前算出作为常数使用，故这里也只用一重循环就可解决，保证最后算法是n<sup>2</sup>的复杂度。
<code>out[i][j]=min(sigma(out[son(i).k][j+1])+f[j],inm[i])。</code>
inm[root]即为最终答案，整个过程可以用记忆化搜索实现。</p>

<pre class="highlight cpp">
<span class="cp">#include &lt;vector&gt;
#include &lt;list&gt;
#include &lt;map&gt;
#include &lt;set&gt;
#include &lt;deque&gt;
#include &lt;stack&gt;
#include &lt;bitset&gt;
#include &lt;algorithm&gt;
#include &lt;functional&gt;
#include &lt;numeric&gt;
#include &lt;utility&gt;
#include &lt;sstream&gt;
#include &lt;iostream&gt;
#include &lt;iomanip&gt;
#include &lt;cstdio&gt;
#include &lt;cmath&gt;
#include &lt;cstdlib&gt;
#include &lt;ctime&gt;
#include &lt;cstring&gt;
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="cp">#define V 1011
#define E 1000001
</span>
<span class="kt">int</span> <span class="n">dfn</span><span class="p">[</span><span class="n">V</span><span class="p">],</span> <span class="n">order</span><span class="p">,</span> <span class="n">anc</span><span class="p">[</span><span class="n">V</span><span class="p">],</span> <span class="n">bridge</span><span class="p">[</span><span class="n">V</span><span class="p">],</span> <span class="n">stk</span><span class="p">[</span><span class="n">V</span><span class="p">],</span> <span class="n">top</span><span class="p">,</span> <span class="n">cntb</span><span class="p">,</span> <span class="n">bcc</span><span class="p">[</span><span class="n">V</span><span class="p">],</span> <span class="n">cntbcc</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">ED</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">v</span><span class="p">;</span>
    <span class="n">ED</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pool</span><span class="p">[</span><span class="n">E</span><span class="p">],</span> <span class="o">*</span><span class="n">base</span><span class="p">[</span><span class="n">V</span><span class="p">],</span> <span class="o">*</span><span class="n">topp</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">init</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">topp</span> <span class="o">=</span> <span class="n">pool</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="n">base</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">addedge</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">j</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">topp</span><span class="o">-&gt;</span><span class="n">v</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
    <span class="n">topp</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">base</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="n">base</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">topp</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">bool</span> <span class="n">vis</span><span class="p">[</span><span class="n">V</span><span class="p">],</span> <span class="n">vise</span><span class="p">[</span><span class="n">E</span><span class="p">];</span>

<span class="kt">void</span> <span class="nf">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">dfn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">order</span><span class="o">++</span><span class="p">;</span>
    <span class="n">vis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">anc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">stk</span><span class="p">[</span><span class="n">top</span><span class="o">++</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">ED</span> <span class="o">*</span><span class="n">ip</span> <span class="o">=</span> <span class="n">base</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">ip</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">ip</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vise</span><span class="p">[</span><span class="n">ip</span> <span class="o">-</span> <span class="n">pool</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">dfn</span><span class="p">[</span><span class="n">anc</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="n">dfn</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="n">anc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">vise</span><span class="p">[</span><span class="n">ip</span> <span class="o">-</span> <span class="n">pool</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">vise</span><span class="p">[(</span><span class="n">ip</span> <span class="o">-</span> <span class="n">pool</span><span class="p">)</span><span class="o">^</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">dfs</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dfn</span><span class="p">[</span><span class="n">anc</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="n">dfn</span><span class="p">[</span><span class="n">anc</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>
                <span class="n">anc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">anc</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">anc</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="p">{</span>
                <span class="n">bridge</span><span class="p">[</span><span class="n">cntb</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ip</span> <span class="o">-</span> <span class="n">pool</span><span class="p">;</span>
                <span class="k">do</span>
                <span class="p">{</span>
                    <span class="n">bcc</span><span class="p">[</span><span class="n">stk</span><span class="p">[</span><span class="o">--</span><span class="n">top</span><span class="p">]]</span><span class="o">=</span><span class="n">cntbcc</span><span class="p">;</span>
                <span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="n">stk</span><span class="p">[</span><span class="n">top</span><span class="p">]</span><span class="o">!=</span><span class="n">j</span><span class="p">);</span>
                <span class="n">cntbcc</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// BCCs are indexed from 0 to cntbcc-1 , bridges are indexed from 0 to cntb-1
</span><span class="kt">void</span> <span class="nf">bridge_bcc</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="n">vis</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">vise</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="n">vise</span><span class="p">));</span>
    <span class="n">cntb</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">cntbcc</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="p">{</span>
            <span class="n">top</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
            <span class="n">order</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
            <span class="k">while</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
                <span class="n">bcc</span><span class="p">[</span><span class="n">stk</span><span class="p">[</span><span class="o">--</span><span class="n">top</span><span class="p">]]</span><span class="o">=</span><span class="n">cntbcc</span><span class="p">;</span>
            <span class="n">cntbcc</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">}</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ed</span><span class="p">[</span><span class="n">V</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="n">V</span><span class="p">],</span><span class="n">cost</span><span class="p">[</span><span class="n">V</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">in</span><span class="p">[</span><span class="n">V</span><span class="p">][</span><span class="n">V</span><span class="p">],</span><span class="n">inm</span><span class="p">[</span><span class="n">V</span><span class="p">],</span><span class="n">out</span><span class="p">[</span><span class="n">V</span><span class="p">][</span><span class="n">V</span><span class="p">];</span>
<span class="n">bool</span> <span class="n">vm</span><span class="p">[</span><span class="n">V</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">},</span><span class="n">vi</span><span class="p">[</span><span class="n">V</span><span class="p">][</span><span class="n">V</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">},</span><span class="n">vo</span><span class="p">[</span><span class="n">V</span><span class="p">][</span><span class="n">V</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="kt">int</span> <span class="n">inf</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">inmf</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">outf</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">inmf</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="n">f</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">vm</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">inm</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">cntbcc</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">inm</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">&gt;</span><span class="n">inf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">f</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">inm</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="n">inf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">f</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="n">vm</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">inm</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">inf</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="kt">int</span> <span class="n">j</span><span class="p">,</span><span class="kt">int</span> <span class="n">f</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">vi</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="k">return</span> <span class="n">in</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
    <span class="n">vi</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">ret</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">k</span><span class="o">&lt;</span><span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">size</span><span class="p">();</span><span class="n">k</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">!=</span><span class="n">f</span><span class="p">)</span>
            <span class="n">ret</span><span class="o">+=</span><span class="n">outf</span><span class="p">(</span><span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">],</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">j</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">in</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">ret</span><span class="o">+</span><span class="n">cost</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">k</span><span class="o">&lt;</span><span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">size</span><span class="p">();</span><span class="n">k</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">!=</span><span class="n">f</span><span class="p">)</span>
            <span class="n">in</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">in</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="n">ret</span><span class="o">+</span><span class="n">inf</span><span class="p">(</span><span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">],</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="n">outf</span><span class="p">(</span><span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">],</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">d</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
    <span class="k">return</span> <span class="n">in</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">outf</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="kt">int</span> <span class="n">j</span><span class="p">,</span><span class="kt">int</span> <span class="n">f</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="o">&gt;=</span><span class="n">cntbcc</span><span class="p">)</span> <span class="k">return</span> <span class="n">outf</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">cntbcc</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">f</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">vo</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="k">return</span> <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
    <span class="n">vo</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">ret</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">k</span><span class="o">&lt;</span><span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">size</span><span class="p">();</span><span class="n">k</span><span class="o">++</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">!=</span><span class="n">f</span><span class="p">)</span>
            <span class="n">ret</span><span class="o">+=</span><span class="n">outf</span><span class="p">(</span><span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">],</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">);</span>
    <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">inmf</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">f</span><span class="p">),</span><span class="n">ret</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
<span class="p">}</span>

<span class="n">bool</span> <span class="n">mtx</span><span class="p">[</span><span class="n">V</span><span class="p">][</span><span class="n">V</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">"%d%d%d"</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="o">&amp;</span><span class="n">m</span><span class="p">,</span><span class="o">&amp;</span><span class="n">c</span><span class="p">)</span><span class="o">!=</span><span class="n">EOF</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">init</span><span class="p">();</span>
        <span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">"%d%d"</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
            <span class="n">addedge</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
            <span class="n">addedge</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
        <span class="n">bridge_bcc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">cntbcc</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">cost</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">mtx</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">mtx</span><span class="p">));</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">cost</span><span class="p">[</span><span class="n">bcc</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="n">ED</span> <span class="o">*</span><span class="n">ip</span><span class="o">=</span><span class="n">base</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="n">ip</span><span class="p">;</span><span class="n">ip</span><span class="o">=</span><span class="n">ip</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">bcc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">!=</span><span class="n">bcc</span><span class="p">[</span><span class="n">ip</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">])</span>
                    <span class="n">mtx</span><span class="p">[</span><span class="n">bcc</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="n">bcc</span><span class="p">[</span><span class="n">ip</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">]]</span><span class="o">=</span><span class="n">mtx</span><span class="p">[</span><span class="n">bcc</span><span class="p">[</span><span class="n">ip</span><span class="o">-&gt;</span><span class="n">v</span><span class="p">]][</span><span class="n">bcc</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">clear</span><span class="p">();</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">cntbcc</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">cntbcc</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">mtx</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                <span class="p">{</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
                    <span class="n">ed</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                <span class="p">}</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">in</span><span class="p">));</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">inm</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">inm</span><span class="p">));</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">out</span><span class="p">));</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">vm</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">vm</span><span class="p">));</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">vi</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">vi</span><span class="p">));</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">vo</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">vo</span><span class="p">));</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">inmf</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<h4 id="play-beans-beans">Play Beans Beans</h4>

<p><strong>[by Lambyy]</strong>水题一枚, 题意可能比较绕, 但自认为题意描述很清楚, 基本按题意模拟下来即可, 第一组Sample 数据即蕴含了本题最大的Trick, 即在每一个Round过程中新产生的空白点, 是不会被进行操作的, 否则Sample就得7了, 相信大部分过了的人都考虑到了这种情况.
定位为简单模拟题, 基本全场题, 没想卡人……</p>

<pre class="highlight cpp"><span class="cp">#include &lt;cstdio&gt;
#include &lt;cstring&gt;
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">flag</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">map</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">N</span><span class="p">];</span>
<span class="n">bool</span> <span class="n">f</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">N</span><span class="p">];</span>

<span class="kt">int</span> <span class="nf">up</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'.'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">i</span><span class="p">;</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">-</span> <span class="sc">'A'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">down</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'.'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">x</span><span class="p">;</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">-</span> <span class="sc">'A'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">left</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">map</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'.'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">i</span><span class="p">;</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">map</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="sc">'A'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">right</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">w</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">map</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'.'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">y</span><span class="p">;</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">map</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="sc">'A'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">solve</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">,</span> <span class="n">t4</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">x4</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">w</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'.'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">w</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">t3</span> <span class="o">=</span> <span class="n">t4</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="p">;</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">x3</span> <span class="o">=</span> <span class="n">x4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">t1</span> <span class="o">=</span> <span class="n">up</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">x1</span><span class="p">);</span>
                <span class="n">t2</span> <span class="o">=</span> <span class="n">down</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">x2</span><span class="p">);</span>
                <span class="n">t3</span> <span class="o">=</span> <span class="n">left</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">x3</span><span class="p">);</span>
                <span class="n">t4</span> <span class="o">=</span> <span class="n">right</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">x4</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">t1</span> <span class="o">==</span> <span class="n">t2</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="n">map</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">x1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'.'</span><span class="p">;</span>
                    <span class="n">map</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">x2</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'.'</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">t1</span> <span class="o">==</span> <span class="n">t3</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="n">map</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">x1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'.'</span><span class="p">;</span>
                    <span class="n">map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">-</span> <span class="n">x3</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'.'</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">t1</span> <span class="o">==</span> <span class="n">t4</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="n">map</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">x1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'.'</span><span class="p">;</span>
                    <span class="n">map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">x4</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'.'</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">t2</span> <span class="o">==</span> <span class="n">t3</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="n">map</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">x2</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'.'</span><span class="p">;</span>
                    <span class="n">map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">-</span> <span class="n">x3</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'.'</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">t2</span> <span class="o">==</span> <span class="n">t4</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="n">map</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">x2</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'.'</span><span class="p">;</span>
                    <span class="n">map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">x4</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'.'</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">t3</span> <span class="o">==</span> <span class="n">t4</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="n">map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">-</span> <span class="n">x3</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'.'</span><span class="p">;</span>
                    <span class="n">map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="n">x4</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'.'</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">solve</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">cnt</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">"%d %d"</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">w</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">scanf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">map</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

        <span class="n">flag</span> <span class="o">=</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">solve</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">w</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
                <span class="n">cnt</span> <span class="o">+=</span> <span class="p">(</span><span class="n">map</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'.'</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">w</span> <span class="o">*</span> <span class="n">h</span> <span class="o">-</span> <span class="n">cnt</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<h4 id="dictionary">Dictionary</h4>

<p>处理XML，求到行首距离为Q的标签的属性。可以一边读入一边递归着求。也可以都读入后去掉正文，再递归处理，总之是递归着做，比较简单。校验时觉得属性名有空格太坑又没什么意思，就把有空格的数据去掉。</p>

<pre class="highlight cpp"><span class="cp">#include &lt;iostream&gt;
#include &lt;sstream&gt;
#include &lt;cstring&gt;
#include &lt;vector&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">S</span><span class="p">,</span> <span class="n">res</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">tag</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">sum</span><span class="p">,</span> <span class="kt">int</span> <span class="n">now</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">now</span> <span class="o">==</span> <span class="n">S</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="n">string</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">now</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tmp</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">++</span> <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'&lt;'</span> <span class="o">||</span> <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'&gt;'</span> <span class="o">||</span> <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">','</span> <span class="p">)</span> <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sc">' '</span><span class="p">;</span>
    <span class="n">stringstream</span> <span class="n">SS</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span> <span class="n">string</span> <span class="n">name</span><span class="p">;</span> <span class="kt">int</span> <span class="n">len</span><span class="p">;</span> <span class="n">SS</span> <span class="o">&gt;&gt;</span> <span class="n">name</span> <span class="o">&gt;&gt;</span> <span class="n">len</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">sum</span> <span class="o">+</span> <span class="n">len</span> <span class="o">==</span> <span class="n">tag</span><span class="p">){</span> <span class="n">res</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">name</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="o">++</span> <span class="n">now</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'/'</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">else</span> <span class="n">dfs</span><span class="p">(</span><span class="n">sum</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">now</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span> <span class="n">scanf</span><span class="p">(</span> <span class="s">"%d%d"</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tag</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">string</span> <span class="n">buf</span><span class="p">;</span>
        <span class="n">getchar</span><span class="p">();</span> <span class="n">S</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span> <span class="n">res</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
        <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
            <span class="n">getline</span><span class="p">(</span> <span class="n">cin</span><span class="p">,</span> <span class="n">buf</span> <span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'&lt;'</span> <span class="o">&amp;</span> <span class="n">buf</span><span class="p">[</span><span class="n">buf</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'&gt;'</span><span class="p">)</span>
                <span class="n">S</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">now</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">dfs</span><span class="p">(</span><span class="n">sum</span><span class="p">,</span> <span class="n">now</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">res</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">++</span> <span class="p">)</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<h4 id="find-the-fraction">Find the Fraction</h4>

<p><strong>[by Lambyy]</strong>这题基本上算是纯数学题吧, 且在ACM数论中针对分数领域题目出的少之又少, 所以此题算是冷门题.</p>

<p>题目是对n阶Farey Sequence中的第k项, 进行分母不大于m的分数逼近. </p>

<p>所以第一步需要求待逼近分数. </p>

<p>对于求Farey Sequence中项有朴素算法, 复杂度是O(n^2)的. 所以对于此题n 10^5的数量级是行不通的. </p>

<p>Farey Sequence性质: </p>
<ul>
<li><strong>性质1</strong>&nbsp;&nbsp;如果a/b,x/y是F<sub>n</sub>中的相邻两项, 那么ay + 1 = bx.<br />
证明: 此结论可根据Fn的构造过程得出. </li>
<li><strong>推论1</strong>&nbsp;&nbsp;F<sub>n</sub>中任意相邻两项之差大于等于1/n(n-1).<br />
证明: 假设这两项顺次分别为a/b和p/q, 则
故得结论。</li></ul>

<p>根据推论1，假设f(i)(1≤i≤n<sup>2</sup>)为F<sub>k</sub>中不大于i/n<sup>2</sup>的项数。则f(i+1)-f(i)≤1。我们只需要在这些值中二分，求出一个满足f(i)=k的i，然后再求出Fn中小于等于i/n<sup>2</sup>的最大分数。先用O(nloglogn)的时间作计算f(i)的预处理，由于每次计算f(i)的时间复杂度为O(n)，二分的次数为O(logn)，最后一次求最大分数时，只要枚举所有分母即可，所以本操作的时间复杂度为O(nlogn)。
得出待逼近分数之后(方便下文解释，设为a/b)，要进行分数逼近操作。</p>

<p>由FareySequence构造方式可知，第m阶Farey数列包含了分母不大于m的所有分数，所以最终所求即是在第m阶Farey数列中最接近a/b的两个数。Farey数列是有序的，我们知道a/b的准确值是出现在第b阶Farey数列中的，利用Farey数列的生成特点，可以从第b阶Farey数列中的a/b准确值反推出第m阶Farey数列中最逼近a/b的两个数，这里b不小于m。</p>

<p>接下来便是一个递归逼近的过程.</p>

<ul>
  <li>对于a/b, 生成在第b阶Farey数列中它的前一项和后一项, c/d和e/f. 
  这里根据性质1, 用扩展gcd算法求解.</li>
  <li>如果d和f均不大于m，那么c/d和e/f就是答案。由于c/d和e/f是第b阶Farey数列中最逼近a/b的数，也同时存在于第m阶Farey序列中，而第m阶Farey序列不可能有比第b阶Farey序列更好的逼近，这便是递归过程的结束条件。</li>
  <li>如果d和f均大于m，那么令a/b等于c/d和e/f分母较小的那个，跳到1，继续递归。</li>
  <li>如果d，f中一个大于m，另一个不大于m，这是显然不大于n的是一个答案。不妨设d&gt;m，而f≤m。我们注意到e/f这一个分数在第m阶Farey数列中就已经存在，而在第d级Farey序列中它与c/d相邻，这里m&lt;d&lt;b，由于Farey数列的特点，c/d左边的那一项与e/f共同生成c/d，因此c/d左边的那一项值为(c-e)/(d-f)，如果d-f值仍然大于n，考虑到c/d生成之前(c-e)/(d-f)是与e/f相邻的，他左边的一项,(c-2<em>e)/(d-2</em>f)，依此类推，我们可以找到k使得(d-k<em>f)&lt;n，这时(c-k</em>e)/(d-k*f) 便是另一个答案。</li>
</ul>

<p>这样便可以得到满足题意要求的两个分数。</p>

<p>关于本题结论 以及更多关于Farey Sequence 的知识, 请参考论文<a href="http://wenku.baidu.com/view/40edb37a32d7375a41780c9.html">《一类分数问题的研究》</a>.</p>

<pre class="highlight cpp"><span class="cp">#include &lt;cstdio&gt;
#include &lt;cstring&gt;
#include &lt;cmath&gt;
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">100010</span><span class="p">;</span>
<span class="kt">long</span> <span class="kt">long</span> <span class="n">n</span><span class="p">,</span> <span class="n">A</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">m</span><span class="p">;</span>

<span class="kt">long</span> <span class="kt">long</span> <span class="nf">gcd</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">a</span><span class="p">,</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span> <span class="o">?</span> <span class="n">gcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span> <span class="o">:</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">long</span> <span class="kt">long</span> <span class="nf">Rank</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">long</span> <span class="kt">long</span> <span class="n">q</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">q</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">q</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">q</span><span class="p">)</span>    <span class="n">A</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span> <span class="o">*</span> <span class="n">a</span> <span class="o">/</span> <span class="n">n</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">q</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">q</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">q</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ans</span> <span class="o">+=</span> <span class="n">A</span><span class="p">[</span><span class="n">q</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">t</span> <span class="o">=</span> <span class="n">q</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">t</span> <span class="o">+=</span> <span class="n">q</span><span class="p">)</span> <span class="n">A</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-=</span> <span class="n">A</span><span class="p">[</span><span class="n">q</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">long</span> <span class="kt">long</span> <span class="nf">bsearch</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">long</span> <span class="kt">long</span> <span class="n">t</span><span class="p">,</span> <span class="n">lt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rt</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span> <span class="n">mid</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">lt</span> <span class="o">&lt;</span> <span class="n">rt</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">lt</span> <span class="o">+</span> <span class="n">rt</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Rank</span><span class="p">(</span><span class="n">mid</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="n">k</span><span class="p">)</span> <span class="k">return</span> <span class="n">mid</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">)</span>  <span class="n">lt</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">else</span> <span class="n">rt</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Rank</span><span class="p">(</span><span class="n">lt</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">k</span> <span class="o">&amp;</span> <span class="n">Rank</span><span class="p">(</span><span class="n">lt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">)</span>   <span class="k">return</span> <span class="n">lt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">return</span> <span class="n">lt</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">search</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">term</span><span class="p">,</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">s</span><span class="p">,</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">p</span><span class="p">,</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">q</span><span class="p">,</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">t1</span><span class="p">,</span> <span class="kt">long</span> <span class="kt">long</span> <span class="o">&amp;</span><span class="n">t2</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">long</span> <span class="kt">long</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">gcd</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">a</span> <span class="o">=</span> <span class="n">s</span> <span class="o">/</span> <span class="n">t</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="n">t</span><span class="p">;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">gcd</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">c</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="n">t</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">q</span> <span class="o">/</span> <span class="n">t</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">term</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">term</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)((</span><span class="n">n</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">d</span><span class="p">);</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">c</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">d</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">e</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">f</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">long</span> <span class="kt">long</span> <span class="nf">ext_gcd</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">a</span><span class="p">,</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">b</span><span class="p">,</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">x</span><span class="p">,</span> <span class="kt">long</span> <span class="kt">long</span><span class="o">&amp;</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">long</span> <span class="kt">long</span> <span class="n">t</span><span class="p">,</span> <span class="n">ret</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">ext_gcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span> <span class="o">*</span> <span class="n">y</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">find</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">a</span><span class="p">,</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">b</span><span class="p">,</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">L1</span><span class="p">,</span><span class="kt">long</span> <span class="kt">long</span> <span class="o">&amp;</span><span class="n">L2</span><span class="p">,</span><span class="kt">long</span> <span class="kt">long</span> <span class="o">&amp;</span><span class="n">R1</span><span class="p">,</span><span class="kt">long</span> <span class="kt">long</span> <span class="o">&amp;</span><span class="n">R2</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">long</span> <span class="kt">long</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
    <span class="n">ext_gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">%</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">L2</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">L1</span> <span class="o">=</span> <span class="p">(</span><span class="n">L2</span> <span class="o">*</span> <span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">R2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">%</span> <span class="n">b</span><span class="p">,</span> <span class="n">R1</span> <span class="o">=</span> <span class="p">(</span><span class="n">R2</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">solve</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">a</span><span class="p">,</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">b</span><span class="p">,</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">L1</span><span class="p">,</span><span class="kt">long</span> <span class="kt">long</span> <span class="o">&amp;</span><span class="n">L2</span><span class="p">,</span><span class="kt">long</span> <span class="kt">long</span> <span class="o">&amp;</span><span class="n">R1</span><span class="p">,</span><span class="kt">long</span> <span class="kt">long</span> <span class="o">&amp;</span><span class="n">R2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">L1</span> <span class="o">=</span> <span class="n">R1</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
        <span class="n">L2</span> <span class="o">=</span> <span class="n">R2</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">find</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">R1</span><span class="p">,</span> <span class="n">R2</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">R2</span> <span class="o">&lt;=</span> <span class="n">m</span> <span class="o">&amp;</span> <span class="n">L2</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">)</span>  <span class="k">return</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">R2</span> <span class="o">&gt;</span> <span class="n">m</span> <span class="o">&amp;</span> <span class="n">L2</span> <span class="o">&gt;</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">R2</span> <span class="o">&gt;</span> <span class="n">L2</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">L1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">L2</span><span class="p">;</span>
            <span class="n">find</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">R1</span><span class="p">,</span> <span class="n">R2</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">R1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">R2</span><span class="p">;</span>
            <span class="n">find</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">R1</span><span class="p">,</span> <span class="n">R2</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kt">long</span> <span class="kt">long</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">L2</span> <span class="o">&gt;</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">L1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">L2</span><span class="p">;</span>
        <span class="n">find</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">R2</span> <span class="o">&gt;</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">R1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">R2</span><span class="p">;</span>
        <span class="n">find</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">R1</span><span class="p">,</span> <span class="n">R2</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="c1">//    freopen("F.in", "r", stdin);
//    freopen("F.out", "w", stdout);
</span>    <span class="kt">long</span> <span class="kt">long</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">;</span>
    <span class="kt">long</span> <span class="kt">long</span> <span class="n">t</span><span class="p">,</span> <span class="n">Up1</span><span class="p">,</span> <span class="n">Up2</span><span class="p">,</span> <span class="n">Down1</span><span class="p">,</span> <span class="n">Down2</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">mi</span><span class="p">,</span> <span class="n">tmp</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">scanf</span> <span class="p">(</span><span class="s">"%lld %lld %lld"</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">k</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">bsearch</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">mi</span> <span class="o">=</span> <span class="mf">1.00</span><span class="p">,</span> <span class="n">po</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">q</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">q</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="n">q</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">p</span> <span class="o">=</span> <span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">q</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="p">(</span><span class="n">q</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&lt;</span> <span class="n">mi</span><span class="p">)</span>  <span class="n">mi</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">po</span> <span class="o">=</span> <span class="n">q</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">po</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">q</span> <span class="o">=</span> <span class="n">po</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">;</span>
        <span class="k">else</span> <span class="n">q</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

        <span class="n">search</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="n">Rank</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">);</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">gcd</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">);</span>
        <span class="n">t1</span> <span class="o">/=</span> <span class="n">t</span><span class="p">,</span> <span class="n">t2</span> <span class="o">/=</span> <span class="n">t</span><span class="p">;</span>

        <span class="n">solve</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">Down1</span><span class="p">,</span> <span class="n">Down2</span><span class="p">,</span> <span class="n">Up1</span><span class="p">,</span> <span class="n">Up2</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%lld/%lld %lld/%lld</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">Down1</span><span class="p">,</span> <span class="n">Down2</span><span class="p">,</span> <span class="n">Up1</span><span class="p">,</span> <span class="n">Up2</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<h4 id="zero-pair">Zero Pair</h4>

<p><strong>[by Xnozero]</strong>将<code>a*b=rev(a)*rev(b)</code>转化为<code>a/rev(a)=rev(b)/b</code>,预处理出范围内的 rev(a)的值,将a/rev(a)的分子分母约分后存入MAP，再对b进行类似的处理，从MAP中找到对应的值，统计总数即可。</p>

<pre class="highlight cpp"><span class="cp">#include&lt;iostream&gt;
#include&lt;map&gt;
#include&lt;cstdio&gt;
#include&lt;cstring&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="n">map</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">hash</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">ext</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">b</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">ext</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">t2</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">t1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">gcd</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">)</span> <span class="k">return</span> <span class="n">gcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">a</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">gcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">%</span><span class="n">b</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">work</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">make_pair</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">),</span><span class="n">b</span><span class="o">/</span><span class="n">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">));</span>
<span class="p">}</span>
<span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">temp</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// freopen("in.txt","r",stdin);
</span>    <span class="kt">int</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">p</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">ans</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">"%d %d %d"</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="o">&amp;</span><span class="n">b</span><span class="p">,</span><span class="o">&amp;</span><span class="n">p</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ans</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">hash</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">a</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ext</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
            <span class="n">x</span><span class="o">=</span><span class="p">((</span><span class="n">x</span><span class="o">%</span><span class="n">p</span><span class="p">)</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="o">%</span><span class="n">p</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="p">;</span>
            <span class="n">hash</span><span class="p">[</span><span class="n">work</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">)]</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">b</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ext</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
            <span class="n">x</span><span class="o">=</span><span class="p">((</span><span class="n">x</span><span class="o">%</span><span class="n">p</span><span class="p">)</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="o">%</span><span class="n">p</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="p">;</span>
            <span class="n">temp</span><span class="o">=</span><span class="n">work</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">hash</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="o">!=</span><span class="n">hash</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="n">ans</span><span class="o">+=</span><span class="n">hash</span><span class="p">[</span><span class="n">temp</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">ans</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<div>_____________________________解题报告分割线_____________________________</div>

<p>比赛现场的情况是这样的</p>

<p><a href="http://blog.oneplus.info/wp-content/uploads/2011/05/rank2.jpg"><img src="http://blog.oneplus.info/wp-content/uploads/2011/05/rank2.jpg" alt="" title="rank2" width="500" class="aligncenter size-full wp-image-303" /></a></p>

<p>比较惊艳的几处:</p>

<ul>
<li>第二、第四是两位哈三中OI的同学，第二的同学好像是NOI银，全场唯一一个搞定了羊的G，真强！</li>
<li>rank 14的同学来自能源学院，寒假时自学过一点C语言，是我程序设计实践的学生，也很强</li>
<li>尤波学长、bin3学长依旧成绩靠前</li>
<li>羊那天说了一句，“后生可畏啊”</li>
<li>刷刷…不说什么了</li>
</ul>

<p>就这样子吧。</p>

</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = 'yjliu'; // required: replace example with your forum shortname
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
 var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
 dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

  </div>

  <footer class="text-center">
    &copy; <a href="http://yjliu.net/">Static Oneplus</a> 2010 - 2014 |
    This site is built by <a href="http://middlemanapp.com/" target="_blank">Middleman</a> and
    <a href="http://getbootstrap.com/">bootstrap</a>.
  </footer>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ['\\(','\\)'] ]
    },
    "HTML-CSS": { linebreaks: { automatic: true } },
});
</script>
<script type="text/javascript"
src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script>
<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
</body>
</html>
